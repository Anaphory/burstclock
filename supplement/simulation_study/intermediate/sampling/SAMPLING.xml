<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<beast version='2.0'
       namespace='beast.evolution.tree
                 :beast.evolution.tree.coalescent
                 :beast.evolution.alignment
                 :beast.evolution.operators
                 :beast.evolution.sitemodel
                 :beast.evolution.substitutionmodel
                 :beast.math.distributions
                 :beast.evolution.nuc
                 :beast.core
                 :beast.core.util
                 :beast.core.parameter
                 :ch.uzh.beast.evolution.branchratemodel'>


<!-- MAP BLOCK -->

<map name="Uniform">beast.math.distributions.Uniform</map>
<map name="Exponential">beast.math.distributions.Exponential</map>
<map name="LogNormal">beast.math.distributions.LogNormalDistributionModel</map>
<map name="Normal">beast.math.distributions.Normal</map>
<map name="Beta">beast.math.distributions.Beta</map>
<map name="Gamma">beast.math.distributions.Gamma</map>
<map name="LaplaceDistribution">beast.math.distributions.LaplaceDistribution</map>
<map name="prior">beast.math.distributions.Prior</map>
<map name="InverseGamma">beast.math.distributions.InverseGamma</map>
<map name="OneOnX">beast.math.distributions.OneOnX</map>



<!-- DATA -->

<taxonset id="taxa" spec="TaxonSet">
    <taxon id="1" spec="Taxon"/>
    <taxon id="2" spec="Taxon"/>
    <taxon id="3" spec="Taxon"/>
    <taxon id="4" spec="Taxon"/>
    <taxon id="5" spec="Taxon"/>
    <taxon id="6" spec="Taxon"/>
    <taxon id="7" spec="Taxon"/>
    <taxon id="8" spec="Taxon"/>
    <taxon id="9" spec="Taxon"/>
    <taxon id="10" spec="Taxon"/>
    <taxon id="11" spec="Taxon"/>
    <taxon id="12" spec="Taxon"/>
    <taxon id="13" spec="Taxon"/>
    <taxon id="14" spec="Taxon"/>
    <taxon id="15" spec="Taxon"/>
    <taxon id="16" spec="Taxon"/>
    <taxon id="17" spec="Taxon"/>
    <taxon id="18" spec="Taxon"/>
    <taxon id="19" spec="Taxon"/>
    <taxon id="20" spec="Taxon"/>
</taxonset>

<data id="data.sim" dataType="binary">
    <sequence taxon="1">?</sequence>
    <sequence taxon="2">?</sequence>
    <sequence taxon="3">?</sequence>
    <sequence taxon="4">?</sequence>
    <sequence taxon="5">?</sequence>
    <sequence taxon="6">?</sequence>
    <sequence taxon="7">?</sequence>
    <sequence taxon="8">?</sequence>
    <sequence taxon="9">?</sequence>
    <sequence taxon="10">?</sequence>
    <sequence taxon="11">?</sequence>
    <sequence taxon="12">?</sequence>
    <sequence taxon="13">?</sequence>
    <sequence taxon="14">?</sequence>
    <sequence taxon="15">?</sequence>
    <sequence taxon="16">?</sequence>
    <sequence taxon="17">?</sequence>
    <sequence taxon="18">?</sequence>
    <sequence taxon="19">?</sequence>
    <sequence taxon="20">?</sequence>
</data>




<!-- SITE AND CLOCK-MODEL -->

<siteModel id="siteModel" spec="SiteModel">
<substModel id="binaryCTMC" spec="GeneralSubstitutionModel">
    <parameter id="rates.binaryCTMC" dimension="2" name="rates">1.0 1.0</parameter>
    <frequencies id="freqs" spec="Frequencies" frequencies="0.5 0.5"/>
</substModel>

</siteModel>
<branchRateModel id="clock" spec="BurstClock" perSplit="@perSplit">
    <branchonlyClock id="innerClock" spec="beast.evolution.branchratemodel.UCRelaxedClockModel" rates="@branchRates" tree="@tree" clock.rate="@clockRate">
        <LogNormal id="logNormal:ucldStdev:clock" meanInRealSpace="true" name="distr" M="1.0" S="@ucldStdev:clock" />
    </branchonlyClock>
</branchRateModel>




<!-- MCMC -->

<run id="mcmc" spec="MCMC" chainLength="20000001" >



    <!-- STATE -->

    <state id="state" storeEvery="10000">
        <stateNode id="tree" spec="Tree" taxonset="@taxa" />
        <stateNode id="clockRate" spec="RealParameter" lower="0.0">0.5</stateNode>
        <stateNode id="ucldStdev:clock" spec="RealParameter" estimate="false" lower="0.0" upper="3.0" value="0.5"/>
        <stateNode id="branchRates" spec="RealParameter" dimension="38" lower="0.0">1.0</stateNode>
        <stateNode id="perSplit" spec="RealParameter" estimate="true">0</stateNode>

        <!--stateNode id="tree" spec="Tree" taxonset="@taxa" /-->
        <stateNode id="birthRate" spec="RealParameter" estimate="false" value="2.8"/>

 
    </state>



    <!-- INITIALIZER -->

    <init id="RandomTree" spec="beast.evolution.tree.SimpleRandomTree" estimate="false" initial="@tree" taxa="@data.sim" rootHeight="1.0" limitCalibrations="0.9" branchMean="0.05" />



    <!-- PRIOR -->

    <distribution id="prior" spec="util.CompoundDistribution">

        <prior id="branchRatesPrior" name="distribution" x="@branchRates">
            <distr spec="LogNormalDistributionModel" meanInRealSpace="true" M="1.0" S="@ucldStdev:clock" />
        </prior>
        <prior id="clockRatePrior" name="distribution" x="@clockRate">
            <distr spec="LogNormalDistributionModel" meanInRealSpace="true" M="0.35" S="0.5"/>
        </prior>
        <prior id="PerSplitPrior" name="distribution" x="@perSplit">
            <distr spec="beast.math.distributions.Normal" mean="0.0" sigma="0.05"/>
        </prior>

            <distribution id="YuleModel" spec="beast.evolution.speciation.YuleModel" tree="@tree" birthDiffRate="@birthRate" conditionalOnRoot="false" />

            <distribution id="clade123.prior" spec="MRCAPrior" tree="@tree" monophyletic="true">
              <taxonset spec="TaxonSet">
                <taxon idref="1" />
                <taxon idref="2" />
                <taxon idref="3" />
              </taxonset>
              <distr spec="Normal" mean="0.35" sigma="0.04"/>
            </distribution>

            <distribution id="clade456.prior" spec="MRCAPrior" tree="@tree" monophyletic="true">
              <taxonset spec="TaxonSet">
                <taxon idref="4" />
                <taxon idref="5" />
                <taxon idref="6" />
              </taxonset>
              <distr spec="Normal" mean="0.4" sigma="0.05"/>
            </distribution>

            <distribution id="clade78.prior" spec="MRCAPrior" tree="@tree" monophyletic="true">
              <taxonset spec="TaxonSet">
                <taxon idref="7" />
                <taxon idref="8" />
              </taxonset>
              <distr spec="Normal" mean="0.2" sigma="0.03"/>
            </distribution>

            <distribution id="clade910.prior" spec="MRCAPrior" tree="@tree" monophyletic="true">
              <taxonset spec="TaxonSet">
                <taxon idref="9" />
                <taxon idref="10" />
              </taxonset>
              <distr spec="Normal" mean="0.16" sigma="0.04"/>
            </distribution>


    </distribution>



    <!-- OPERATORS -->

    <operator id="clockRateScaler" spec="ScaleOperator" parameter="@clockRate" scaleFactor="0.35" weight="4.0"/>
    <operator id="branchRatesRandomWalk" spec="RealRandomWalkOperator" parameter="@branchRates" windowSize="0.2" weight="6.0"/>
    <operator id="branchRatesScaleOperator" spec="ScaleOperator" parameter="@branchRates" scaleFactor="0.8" weight="6.0"/>
    <operator id="RatesSwapOperator" spec="SwapOperator" parameter="@branchRates" weight="2.0"/>
    <operator id="BurstClockRandomWalk" spec="RealRandomWalkOperator" windowSize="0.25" parameter="@perSplit" useGaussian="true" weight="4.0"/>

    <operator id="SubtreeSlide.t:tree" size="0.2" spec="SubtreeSlide" tree="@tree" weight="15.0"/>
    <operator id="NNI" spec="NNI" size="0.1" weight="15" tree="@tree"/>
    <operator id="SPR" spec="SPR" size="0.05" weight="3" tree="@tree"/>
    <operator id="narrow.t:z" spec="Exchange" tree="@tree" weight="10.0"/>
    <operator id="wide.t:z" isNarrow="false" spec="Exchange" tree="@tree" weight="8.0"/>
    <operator id="WilsonBalding.t:z" spec="WilsonBalding" tree="@tree" weight="8.0"/>
    <operator id="UniformOperator.t" spec="Uniform" tree="@tree" weight="20.0"/>
    <operator id="treescaler.rootOnly.t" spec="ScaleOperator" rootOnly="true" scaleFactor="0.5" tree="@tree" weight="1.0"/>
    <operator id="treescaler.t" spec="ScaleOperator" scaleFactor="0.7" tree="@tree" weight="2.0"/>
    <operator id="treescaler.updown.t" spec="UpDownOperator" scaleFactor="0.7" weight="8.0">
        <up idref="clockRate"/>
        <down idref="tree"/>
    </operator>




    <!-- LOGGERS -->

    <logger id="tracelog"  spec="Logger" fileName="$(filebase).log" logEvery="200000"
            sanitiseHeaders="true" sort="smart">
        <log idref="prior"/>
        <log idref="clockRate"/>
        <log idref="ucldStdev:clock"/>
        <log idref="perSplit"/>
        <log idref="branchRates"/>

        <log idref="birthRate"/>
        <log spec="TreeStatLogger" tree="@tree" />


    </logger>

    <logger id="screenlog" spec="Logger" logEvery="200000">
        <log idref="prior"/>
        <log idref="clockRate"/>
        <log idref="ucldStdev:clock"/>
        <log idref="perSplit"/>
        <log idref="branchRates"/>

        <log idref="birthRate"/>
        <log spec="TreeStatLogger" tree="@tree" />


    </logger>

    <logger spec="Logger" fileName="$(filebase).trees" logEvery="200000" mode="tree">
    	<log spec="TreeWithMetaDataLogger" tree="@tree" branchratemodel="@clock"/>
    </logger>
</run>
  
</beast>
