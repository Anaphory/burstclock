<beast beautitemplate="BinaryCTMC" beautistatus="" namespace="beast.core:beast.evolution.alignment:beast.evolution.tree.coalescent:beast.core.util:beast.evolution.nuc:beast.evolution.operators:beast.evolution.sitemodel:beast.evolution.substitutionmodel:beast.evolution.likelihood" required="" version="2.6">
  <data>...</data>

  <map name="Uniform">beast.math.distributions.Uniform</map>
  <map name="Exponential">beast.math.distributions.Exponential</map>
  <map name="LogNormal">beast.math.distributions.LogNormalDistributionModel</map>
  <map name="Normal">beast.math.distributions.Normal</map>
  <map name="Beta">beast.math.distributions.Beta</map>
  <map name="Gamma">beast.math.distributions.Gamma</map>
  <map name="LaplaceDistribution">beast.math.distributions.LaplaceDistribution</map>
  <map name="prior">beast.math.distributions.Prior</map>
  <map name="InverseGamma">beast.math.distributions.InverseGamma</map>
  <map name="OneOnX">beast.math.distributions.OneOnX</map>

  <run id="mcmc" spec="MCMC" chainLength="50000000" numInitializationAttempts="1000" sampleFromPrior="false">
    <state id="state" spec="State" storeEvery="5000">
      <tree id="Tree.t:tree" spec="beast.evolution.tree.Tree" name="stateNode">
        <trait id="dateTrait.t:tree" spec="beast.evolution.tree.TraitSet" traitname="date-backward" value="">
          <taxa id="TaxonSet.vocabulary" spec="TaxonSet">
            <alignment idref="vocabulary" />
          </taxa>
        </trait>
      </tree>
      <parameter id="gammaShape.s:vocabulary" spec="parameter.RealParameter" name="stateNode">1.0</parameter>
      <parameter id="freqParameter" spec="parameter.RealParameter" dimension="2" lower="0.0" name="stateNode" upper="1.0">0.9 0.1</parameter>
      <parameter id="lossRate" spec="parameter.RealParameter" name="stateNode">0.001</parameter>
      <parameter id="BDBirthRate.t:tree" spec="parameter.RealParameter" lower="0.0" name="stateNode" upper="10000.0">0.0005</parameter>
      <parameter id="BDDeathRate.t:tree" spec="parameter.RealParameter" lower="0.0" name="stateNode" upper="1.0">0.5</parameter>
      <parameter id="SamplingProportion" spec="parameter.RealParameter" lower="0.0" name="stateNode" upper="1.0">1e-4 0.2</parameter> <!--
      I'm a bit confused which one is the older and which one the younger sampling proportion.

      I would like to se the older sampling proportion to 0.0, but that breaks the
      model, so maybe it should be about 1/10000, because there were presumably
      thousands of languages that died out before Christians and linguists
      started collecting languages, and only a handful have left writing
      that would give us enough data for word lists. -->
      <parameter id="removalProbability" name="stateNode"> 0.5 </parameter> <!--
      This assumes a language is removed with probability 1/2 from being sampled. Of course, the actual causality is different: The language is not removed due to being sampled, but instead one of two things may happen: Eiter the later removal of the language makes the sample interesting enough to be included (eg. Gothic), or the sampling makes it more interesting to sample other languages afterwards, so it's the last sample of the language nonetheless. Of course, this logic only applies to non-ancestral languages, which is why we don't assume a higher removal probability.  -->
    </state>

    <init estimate="false" id="startingTree" initial="@Tree.t:tree" taxonset="@taxa" spec="beast.evolution.tree.RandomTree">
      <populationModel spec="ConstantPopulation">
        <popSize spec="parameter.RealParameter" value="10000" />
      </populationModel>
    </init>

    <distribution id="posterior" spec="util.CompoundDistribution">
      <distribution id="prior" spec="util.CompoundDistribution">
        <distribution id="BirthDeath.t:tree" spec="beast.evolution.speciation.BirthDeathSkylineModel" tree="@Tree.t:tree" rho="0.5131578947368421" conditionOnRoot="true" conditionOnSurvival="false" reverseTimeArrays="true true true true true">
          <removalProbability idref="removalProbability" />
          <netDiversification idref="BDBirthRate.t:tree" />
          <turnOver idref="BDDeathRate.t:tree" />
          <samplingProportion idref="SamplingProportion" />
          <parameter name="samplingRateChangeTimes" id="SamplingChangeTime">0. 500.</parameter>
        </distribution>
        
        <prior id="BirthRatePrior.t:tree" name="distribution" x="@BDBirthRate.t:tree">
          <LogNormal id="LogNormal.BirthRate" name="distr">
            <M id="LogNormalMean.BirthRate" spec="parameter.RealParameter" estimate="false">-7.316</M> <!-- Estimate based on 100 languages over 10000 years -->
            <S id="LogNormalStd.BirthRate" spec="parameter.RealParameter" estimate="false">2.302585092994046</S> <!-- One order of magnitude standard deviation -->
          </LogNormal>
        </prior>
        <prior id="DeathRatePrior.t:tree" name="distribution" x="@BDDeathRate.t:tree">
          <Beta id="Beta.DeathRate" name="distr" alpha="5" beta="2" /> <!-- We do not know much, but we do know some lanugages are extinct and in the expanding lanugage families we look at it seems like the majority are not. And we vaguely see death rates around 0.2~0.5 inferred in other language phylogenies. -->
        </prior>
        <prior id="ClockPrior.c:clock" name="distribution" x="@lossRate">
          <LogNormal id="LogNormalDistributionModel.0" name="distr">
            <parameter id="RealParameter.6" spec="parameter.RealParameter" estimate="false" name="M">-8.724797332125648</parameter> <!-- 85% stability in 1000 years -->
            <parameter id="RealParameter.7" spec="parameter.RealParameter" estimate="false" lower="0.0" name="S" upper="5.0">1.151292546497023</parameter> <!-- Half an order of magnitude standard deviation â€“ we could probably get actual estimates from the literature -->
          </LogNormal>
        </prior>
        <prior id="GammaShapePrior.s:vocabulary" name="distribution" x="@gammaShape.s:vocabulary">
          <Exponential id="Exponential.0" name="distr">
            <parameter id="RealParameter.0" spec="parameter.RealParameter" lower="0.0" name="mean" upper="0.0">1.0</parameter>
          </Exponential>
        </prior>
      </distribution>
      <distribution id="likelihood" spec="util.CompoundDistribution" useThreads="true">
        <distribution id="treeLikelihood.vocabulary" spec="TreeLikelihood" tree="@Tree.t:tree">
          <data id="bin.vocabulary" spec="FilteredAlignment" ascertained="true" data="@vocabulary" excludeto="1" filter="::">
            <userDataType id="Binary.0" spec="beast.evolution.datatype.Binary" />
          </data>
          <siteModel id="SiteModel.s:vocabulary" spec="SiteModel" gammaCategoryCount="4" mutationRate="1.0" shape="@gammaShape.s:vocabulary">
            <parameter id="proportionInvariant.s:vocabulary" spec="parameter.RealParameter" estimate="false" lower="0.0" name="proportionInvariant" upper="1.0">0.0</parameter>
            <substModel id="CTMC.s:vocabulary" spec="GeneralSubstitutionModel">
              <parameter id="rates.s:vocabulary" spec="parameter.RealParameter" dimension="2" estimate="false" lower="0.0" name="rates">1.0 1.0</parameter>
              <frequencies id="estimatedFreqs.s:vocabulary" spec="Frequencies" frequencies="@freqParameter" />
            </substModel>
          </siteModel>
          <branchRateModel id="StrictClock.c:clock" spec="beast.evolution.branchratemodel.StrictClockModel">
            <expression id="clockrate" name="clock.rate" spec="feast.expressions.ExpCalculator">
              <arg idref="lossRate" />
              <arg idref="freqParameter" />
              2 * freqParameter[1] * lossRate
              <!-- Substitution is normalized by a factor N such that 2 * f[1] * f[0] * N = 1, so the loss rate and clock rate are related by l = f[0] * N * c = 1 / (2 * f[1]) * N * c so c = 2 * f[1] * l -->
            </expression>
          </branchRateModel>
        </distribution>
      </distribution>
    </distribution>

    <operator id="gammaShapeScaler.s:vocabulary" spec="ScaleOperator" parameter="@gammaShape.s:vocabulary" scaleFactor="0.5" weight="0.1" />
    <operator id="FrequenciesExchanger.s:vocabulary" spec="DeltaExchangeOperator" delta="0.003" weight="1.0">
      <parameter idref="freqParameter" />
    </operator>
    <operator id="StrictClockRateScaler.c:clock" spec="ScaleOperator" parameter="@lossRate" scaleFactor="0.9" weight="4.0" />
    <operator id="strictClockUpDownOperator.c:clock" spec="UpDownOperator" scaleFactor="0.9" weight="3.0">
      <up idref="lossRate" />
      <down idref="Tree.t:tree" />
    </operator>
    <operator id="SampledAncestorJump" spec="LeafToSampledAncestorJump" removalProbability="@removalProbability" tree="@Tree.t:tree" weight="3.0" />
    <operator id="BirthDeathTreeScaler.t:tree" spec="SAScaleOperator" scaleFactor="0.95" tree="@Tree.t:tree" weight="3.0" />
    <operator id="BirthDeathTreeRootScaler.t:tree" spec="SAScaleOperator" rootOnly="true" scaleFactor="0.6" tree="@Tree.t:tree" weight="2.0" />
    <operator id="BirthDeathUniformOperator.t:tree" spec="SAUniform" tree="@Tree.t:tree" weight="30.0" />
    <!-- <operator id="BirthDeathSubtreeSlide.t:tree" spec="SubtreeSlide" tree="@Tree.t:tree" size="4" weight="15.0" /> -->
    <operator id="BirthDeathNarrow.t:tree" spec="SAExchange" tree="@Tree.t:tree" weight="15.0" />
    <operator id="BirthDeathWide.t:tree" spec="SAExchange" isNarrow="false" tree="@Tree.t:tree" weight="3.0" />
    <operator id="BirthDeathWilsonBalding.t:tree" spec="SAWilsonBalding" tree="@Tree.t:tree" weight="1.0" />
    <operator id="BirthRateScaler.t:tree" spec="ScaleOperator" parameter="@BDBirthRate.t:tree" scaleFactor="0.9" weight="6.0" />
    <operator id="BirthRateUpDownOperator.c:clock" spec="UpDownOperator" scaleFactor="0.9" weight="3.0">
      <up idref="BDBirthRate.t:tree" />
      <down idref="Tree.t:tree" />
    </operator>
    <operator id="DeathRateScaler.t:tree" spec="ScaleOperator" parameter="@BDDeathRate.t:tree" scaleFactor="0.9" weight="3.0" />
    <operator id="SamplingProportionScaler" spec="ScaleOperator" parameter="@SamplingProportion" scaleAllIndependently="true" scaleFactor="0.9" weight="4.0" />
    <operator id="DeathRateUpDownOperator.c:clock" spec="UpDownOperator" scaleFactor="0.9" weight="3.0">
      <up idref="BDDeathRate.t:tree" />
      <down idref="Tree.t:tree" />
    </operator>
    <operator id="BirthDeathRatesUpDownOperator.c:clock" spec="UpDownOperator" scaleFactor="0.9" weight="3.0">
      <up idref="BDDeathRate.t:tree" />
      <down idref="BDBirthRate.t:tree" />
    </operator>

    <logger id="tracelog" spec="Logger" fileName="vocabulary.log" logEvery="5000" model="@posterior" sort="smart">
      <log idref="posterior" />
      <log idref="likelihood" />
      <log idref="prior" />
      <log id="TreeHeight.t:tree" spec="beast.evolution.tree.TreeHeightLogger" tree="@Tree.t:tree" />
      <log idref="gammaShape.s:vocabulary" />
      <log idref="freqParameter" />
      <log idref="lossRate" />
      <log idref="clockrate" />
      
      <log idref="BDBirthRate.t:tree" />
      <log idref="BDDeathRate.t:tree" />
      <log idref="SamplingProportion" />
    </logger>
    <logger id="screenlog" spec="Logger" logEvery="5000">
      <log idref="posterior" />
      <log id="ESS.0" spec="util.ESS" arg="@posterior" />
      <log idref="likelihood" />
      <log idref="prior" />
    </logger>
    <logger id="treelog.t:tree" spec="Logger" fileName="vocabulary.trees" logEvery="5000" mode="tree">
      <log id="TreeWithMetaDataLogger.t:tree" spec="beast.evolution.tree.TreeWithMetaDataLogger" tree="@Tree.t:tree" />
    </logger>

  </run>
</beast>
